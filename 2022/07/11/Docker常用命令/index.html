<!DOCTYPE html>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-mac-osx.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Docker的基本组成镜像（image） Docker镜像（Image）就是一个只读的模板。镜像可以用来创建Docker容器，一个镜像可以创建很多容器。 它也相当于一个root文件系统。比如官方镜像CentOs:7就包含了一套CentOs:7最小系统的root文件系统。 相当于容器的“源代码”，docker镜像文件类似于Java的类模板，而docker容器实例类似于Java中new出来的实例对象。">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker常用命令">
<meta property="og:url" content="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/index.html">
<meta property="og:site_name" content="蒙珣的博客">
<meta property="og:description" content="Docker的基本组成镜像（image） Docker镜像（Image）就是一个只读的模板。镜像可以用来创建Docker容器，一个镜像可以创建很多容器。 它也相当于一个root文件系统。比如官方镜像CentOs:7就包含了一套CentOs:7最小系统的root文件系统。 相当于容器的“源代码”，docker镜像文件类似于Java的类模板，而docker容器实例类似于Java中new出来的实例对象。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/1.png">
<meta property="og:image" content="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/2.png">
<meta property="og:image" content="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/3.png">
<meta property="og:image" content="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/4.png">
<meta property="og:image" content="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/5.png">
<meta property="og:image" content="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/6.png">
<meta property="og:image" content="c:/Users/William/AppData/Roaming/Typora/typora-user-images/image-20220803125107969.png">
<meta property="article:published_time" content="2022-07-10T16:17:08.000Z">
<meta property="article:modified_time" content="2022-08-08T14:11:03.859Z">
<meta property="article:author" content="蒙珣">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/1.png">

<link rel="canonical" href="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh_CN'
  };
</script>

  <title>Docker常用命令 | 蒙珣的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="蒙珣的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">蒙珣的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">未来很长，当有勇气面对，当与自己和解。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">34</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">16</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">157</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh_CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/11/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo.JPG">
      <meta itemprop="name" content="蒙珣">
      <meta itemprop="description" content="过去就像攥在手中的一把干沙，自以为攥得很紧，其实早就从指缝中流光了。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蒙珣的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker常用命令
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-07-11 00:17:08" itemprop="dateCreated datePublished" datetime="2022-07-11T00:17:08+08:00">2022-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-08-08 22:11:03" itemprop="dateModified" datetime="2022-08-08T22:11:03+08:00">2022-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>30k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>27 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Docker的基本组成"><a href="#Docker的基本组成" class="headerlink" title="Docker的基本组成"></a>Docker的基本组成</h2><p><strong>镜像（image）</strong></p>
<p>Docker镜像（Image）就是一个<strong>只读</strong>的模板。镜像可以用来创建Docker容器，<strong>一个镜像可以创建很多容器。</strong></p>
<p>它也相当于一个root文件系统。比如官方镜像CentOs:7就包含了一套CentOs:7最小系统的root文件系统。</p>
<p>相当于容器的“源代码”，<font color="red">docker镜像文件类似于Java的类模板，而docker容器实例类似于Java中new出来的实例对象。</font></p>
<span id="more"></span>



<p><strong>容器（container）</strong></p>
<ul>
<li><p>从面向对象角度</p>
<p>Docker利用容器（Container）独立运行的一个或一组应用，应用程序或服务运行在容器里面，容器就类似于一个虚拟化的运行环境，容器就是用镜像创建的运行实例。就像是Java中的类和实例对象一样，镜像是静态的定义，容器是镜像运行时的实体。容器为镜像提供了一个标准的和隔离的运行环境，它可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台。</p>
</li>
<li><p>从镜像容器角度</p>
<p><font color="red">可以把容器看做是一个简易版的Linux环境</font>（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。</p>
</li>
<li><p>仓库（Repository）</p>
<p>仓库（Repository）是<font color="red">集中存放镜像</font>文件的场所。</p>
<p>类似于 <strong>Maven</strong> 仓库，存放各种 <strong>jar</strong> 包的地方；</p>
<p><strong>GitHub</strong> 仓库，存放各种 <strong>git</strong> 项目的地方；</p>
<p><strong>Docker</strong> 公司提供的官方 <strong>registry</strong> 被称为 <strong>Docker Hub</strong>，存放各种进项模板的地方。</p>
<p>仓库分为公开仓库（Public）和私有仓库（Private）两种形式。</p>
<p>最大的公开仓库是 Docker Hub(<a target="_blank" rel="noopener" href="https://hub.docker.com/)%EF%BC%8C%E5%AD%98%E6%94%BE%E4%BA%86%E6%95%B0%E9%87%8F%E5%BA%9E%E5%A4%A7%E7%9A%84%E9%95%9C%E5%83%8F%E4%BE%9B%E7%94%A8%E6%88%B7%E4%B8%8B%E8%BD%BD%E3%80%82%E5%9B%BD%E5%86%85%E7%9A%84%E5%85%AC%E5%BC%80%E4%BB%93%E5%BA%93%E5%8C%85%E6%8B%AC%E9%98%BF%E9%87%8C%E4%BA%91">https://hub.docker.com/)，存放了数量庞大的镜像供用户下载。国内的公开仓库包括阿里云</a> 、网易云等。</p>
</li>
<li><p>总结</p>
<p><font color="blue">需要正确的理解仓库/镜像/容器这几个概念:</font></p>
<p><font color="blue">Docker</font></p>
<ul>
<li>本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就是image镜像文件。只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。</li>
</ul>
<p><font color="blue">Image</font></p>
<ul>
<li>文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。</li>
</ul>
<p><font color="blue">镜像文件</font></p>
<ul>
<li>image 文件生成的容器实例，本身也是一个文件，称为镜像文件。</li>
</ul>
<p><font color="blue">容器实例</font></p>
<ul>
<li>一个容器运行一种服务，当我们需要的时候，就可以通过docker客户端创建一个对应的运行实例，也就是我们的容器</li>
</ul>
<p><font color="blue">仓库</font></p>
<ul>
<li>就是放一堆镜像的地方，我们可以把镜像发布到仓库中，需要的时候再从仓库中拉下来就可以了。</li>
</ul>
</li>
</ul>
<h2 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h2><h3 id="帮助启动类命令"><a href="#帮助启动类命令" class="headerlink" title="帮助启动类命令"></a>帮助启动类命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动docker</span></span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止docker</span></span><br><span class="line">sudo systemctl stop docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看docker状态</span></span><br><span class="line">sudo systemctl status docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机启动</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看docker概要信息</span></span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看docker总体帮助文档</span></span><br><span class="line">docker --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看docker命令帮助文档</span></span><br><span class="line">docker 具体命令 --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><ul>
<li><p><code>docker images</code>：列出本地主机上的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-a：列出本地所有的镜像（含历史映像层）</span><br><span class="line">-q：只显示镜像ID</span><br></pre></td></tr></table></figure></li>
<li><p><code>docker search 某个xxx镜像名字</code>：</p>
<p>网站：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令</span></span><br><span class="line">docker search [options] 镜像名字</span><br><span class="line"></span><br><span class="line"><span class="comment"># options说明</span></span><br><span class="line">--<span class="built_in">limit</span>：只列出N个镜像，默认25个</span><br><span class="line">docker search --<span class="built_in">limit</span> 5 redis</span><br></pre></td></tr></table></figure></li>
<li><p><code>docker pull 某个xxx镜像名字</code>：下载镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写法1：+TAG 镜像版本号</span></span><br><span class="line">docker pull 镜像名字[:TAG]</span><br><span class="line"><span class="comment"># 例如：docker pull redis:6.0.8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写法2：下载最新版latest</span></span><br><span class="line">docker pull 镜像名字</span><br></pre></td></tr></table></figure></li>
<li><p><code>docker system df</code>：查看镜像、容器、数据卷所占空间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ docker system df</span><br><span class="line">TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</span><br><span class="line">Images          1         1         9.136kB   0B (0%)</span><br><span class="line">Containers      2         0         0B        0B</span><br><span class="line">Local Volumes   0         0         0B        0B</span><br><span class="line">Build Cache     0         0         0B        0B</span><br><span class="line"></span><br><span class="line"><span class="comment"># Images 镜像有几个</span></span><br><span class="line"><span class="comment"># Containers 容器有几个</span></span><br><span class="line"><span class="comment"># Local Volumes 本地卷</span></span><br><span class="line"><span class="comment"># Build Cache 构建的缓存</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>docker rmi 某个xxx镜像名字ID</code>：删除镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-f 强制删除</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除单个镜像</span></span><br><span class="line">docker rmi -f 镜像ID</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除多个镜像</span></span><br><span class="line">docker rmi -f 镜像名1:TAG 镜像名2:TAG</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除全部</span></span><br><span class="line">docker rmi -f $(docker images -qa)</span><br><span class="line"><span class="comment"># $() 引用命令</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>问题：docker虚悬镜像是什么？</strong></p>
<ul>
<li><p>仓库名、标签都是<none>的镜像，俗称虚悬镜像<code>dangling image</code>，工作中没有什么用，建议删除。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">&lt;none&gt;   			&lt;none&gt;    18e5af790473   9 months ago   9.14kB</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><ul>
<li><p>新建+启动容器</p>
<p><code>docker run [OPTIONS] IMAGE [COMMAND] [ARG]</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># options 说明</span></span><br><span class="line">--name=<span class="string">&quot;容器新名字&quot;</span>	为容器指定一个名称</span><br><span class="line">-d:	后台运行容器并返回容器ID，即启动守护式容器（后台运行）</span><br><span class="line"></span><br><span class="line">-i: 以交互模式运行容器，通常与-t同时使用</span><br><span class="line">-t：为容器重新分配一个伪输入终端，通常与-同时使用</span><br><span class="line">即启动交互式容器（前台有伪终端，等待交互），退出终端输入：<span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">-P：随机端口映射</span><br><span class="line">-p：指定端口映射</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用镜像ubuntu:latest 以交互模式启动一个容器，在容器内执行bash命令</span></span><br><span class="line">$ sudo docker run -it ubuntu bash</span><br><span class="line">root@908d43950860:/<span class="comment"># ps -ef</span></span><br><span class="line">UID          PID    PPID  C STIME TTY          TIME CMD</span><br><span class="line">root           1       0  0 13:00 pts/0    00:00:00 bash</span><br><span class="line">root           9       1  0 13:00 pts/0    00:00:00 ps -ef</span><br><span class="line">root@908d43950860:/<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure></li>
<li><p>列出当前所有正在运行的容器</p>
<p><code>docker ps [OPTIONS]</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># options 说明</span></span><br><span class="line">-a：列出当前所有正在运行的容器+历史上运行过的</span><br><span class="line">-l：显示最近创建的容器</span><br><span class="line">-n：显示最近n个创建的容器</span><br><span class="line">-q：静默模式，只显示容器编号</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run -it --name=myyu1 ubuntu bash</span><br><span class="line">root@96e714997794:/<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS          PORTS     NAMES</span><br><span class="line">96e714997794   ubuntu    <span class="string">&quot;bash&quot;</span>    45 seconds ago   Up 45 seconds             myyu1</span><br><span class="line"></span><br><span class="line"><span class="comment"># CONTAINER ID 容器名</span></span><br><span class="line"><span class="comment"># IMAGE 镜像名</span></span><br><span class="line"><span class="comment"># COMMAND 运行的命令</span></span><br><span class="line"><span class="comment"># CREATED 运行时间</span></span><br><span class="line"><span class="comment"># PORTS 暴露端口号</span></span><br><span class="line"><span class="comment"># NAMES 名称</span></span><br></pre></td></tr></table></figure></li>
<li><p>退出容器</p>
<p><code>exit</code>：run进入容器，exit退出，容器会停止</p>
<p><code>ctrl+p+q</code>：run进入容器，ctrl+p+q退出，容器不会停止</p>
</li>
<li><p>启动已停止运行的容器</p>
<p><code>docker start 容器ID或容器名</code></p>
</li>
<li><p>重启容器</p>
<p><code>docker restart 容器ID或容器名</code></p>
</li>
<li><p>停止容器</p>
<p><code>docker stop 容器ID或容器名</code></p>
</li>
<li><p>强制停止容器</p>
<p><code>docker kill 容器ID或容器名</code></p>
</li>
<li><p>删除已停止的容器</p>
<p><code>docker rm 容器ID</code></p>
</li>
<li><p>一次性删除多个容器实例</p>
<p><code>docker rm -f $(docker ps -aq)</code> 或者 <code>docker ps -aq | xargs docker rm</code></p>
</li>
</ul>
<h3 id="重要"><a href="#重要" class="headerlink" title="重要"></a>重要</h3><h4 id="启动守护式容器（后台服务器）"><a href="#启动守护式容器（后台服务器）" class="headerlink" title="启动守护式容器（后台服务器）"></a>启动守护式容器（后台服务器）</h4><p><code>docker run -d 容器名</code> </p>
<p><strong>注意</strong></p>
<p>使用镜像ubuntu:lates以后台启动一个容器</p>
<p><code>sudo docker run -d ubuntu</code></p>
<p>问题：使用<code>sudo docker ps -a </code> 进行查看，发现容器已经退出</p>
<p><strong>很重要说明一点：<font color="red">Docker容器后台运行，就必须有一个前台进程</font></strong></p>
<p>容器运行的命令如果不是那些<strong>一直挂起的命令（比如运行top、tail），就是会自动退出的</strong></p>
<p>这个是Docker的机制问题，比如你的web容器，我们以nginx为例，正常情况下：</p>
<p>我们配置启动服务只需要启动响应的service即可，例如<code>service nginx start</code></p>
<p>但是，这样做 nginx 为后台进程模式运行，就导致docker前台没有运行的应用。</p>
<p>这样的容器后台启动后，会立即自杀因为他觉得他无事可做了</p>
<p>所以，最佳的解决方案是：**<font color="red">将你要运行的程序以前台进程的形式运行，常见就是命令行模式，表示还有交互操作，别中断。</font>**</p>
<h4 id="查看容器日志"><a href="#查看容器日志" class="headerlink" title="查看容器日志"></a>查看容器日志</h4><p><code>docker logs 容器ID</code></p>
<h4 id="查看容器内部运行的进程"><a href="#查看容器内部运行的进程" class="headerlink" title="查看容器内部运行的进程"></a>查看容器内部运行的进程</h4><p><code>docker top 容器ID</code></p>
<h4 id="查看容器内部细节"><a href="#查看容器内部细节" class="headerlink" title="查看容器内部细节"></a>查看容器内部细节</h4><p><code>docker inspect 容器ID</code></p>
<h4 id="进入正在运行的容器并以命令行交互"><a href="#进入正在运行的容器并以命令行交互" class="headerlink" title="进入正在运行的容器并以命令行交互"></a><strong>进入正在运行的容器并以命令行交互</strong></h4><p><code>docker exec -it 容器ID /bin/bash</code>  推荐使用</p>
<p>重新进入 <code>docker attach 容器ID</code></p>
<p>上述两个区别：</p>
<ul>
<li><p>attach 直接进入容器启动命令的终端，不会启动新的进程，用exit退出，会导致容器停止。</p>
</li>
<li><p>exec 是在容器中打开新的终端，并且可以启动新的进程，用exit退出，不会导致容器停止。</p>
</li>
<li><p>从容器内拷贝文件到主机上</p>
<p><code>docker cp 容器ID:容器内路径 目的主机路径</code></p>
</li>
</ul>
<h4 id="导入和导出容器"><a href="#导入和导出容器" class="headerlink" title="导入和导出容器"></a>导入和导出容器</h4><ul>
<li>export 导出容器的内容留作为一个tar归档文件 [对应import命令]</li>
<li>import 从tar包中的内容创建一个新的文件系统再导入为镜像 [对应export]</li>
</ul>
<p><strong>案例</strong></p>
<p>export</p>
<p><code>docker export 容器ID &gt; 文件名.tar</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/william/DYJ</span><br><span class="line"></span><br><span class="line">$ sudo docker images</span><br><span class="line">[sudo] password <span class="keyword">for</span> william:</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat        latest    b64abfdee99c   6 months ago    668MB</span><br><span class="line">ubuntu        latest    d5ca7a445605   8 months ago    65.6MB</span><br><span class="line">hello-world   latest    18e5af790473   9 months ago    9.14kB</span><br><span class="line">redis         6.0.8     d4deb73856a2   20 months ago   98.5MB</span><br><span class="line"></span><br><span class="line">$ sudo docker run -it ubuntu /bin/bash</span><br><span class="line">root@69d281c34a71:/<span class="comment"># %</span></span><br><span class="line"></span><br><span class="line">$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">69d281c34a71   ubuntu    <span class="string">&quot;/bin/bash&quot;</span>   30 seconds ago   Up 30 seconds             friendly_kapitsa</span><br><span class="line"></span><br><span class="line">$ sudo docker <span class="built_in">export</span> 69d281c34a71 &gt; adcd.tar.gz</span><br><span class="line"></span><br><span class="line">$ ls</span><br><span class="line">adcd.tar.gz   git  java  python  shell</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>  import </p>
<p><code>cat 文件名.tar | docker import - 镜像用户/镜像名:镜像版本号</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat 文件名.tar | docker import - 镜像用户/镜像名:镜像版本号</span></span><br><span class="line">$ cat adcd.tar.gz | docker import - william/ubuntu</span><br><span class="line">sha256:8c2d3dca3bda65e49ad314f30f56c6ae3b7ff5c65d83e6f61d8af87979269b20</span><br></pre></td></tr></table></figure>

<h3 id="小总结-常用命令"><a href="#小总结-常用命令" class="headerlink" title="小总结-常用命令"></a>小总结-常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">attach    Attach to a running container                 # 当前 shell 下 attach 连接指定运行镜像</span><br><span class="line"></span><br><span class="line">build     Build an image from a Dockerfile              # 通过 Dockerfile 定制镜像</span><br><span class="line"></span><br><span class="line">commit    Create a new image from a container changes   # 提交当前容器为新的镜像</span><br><span class="line"></span><br><span class="line">cp        Copy files/folders from the containers filesystem to the host path   #从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line"></span><br><span class="line">create    Create a new container                        # 创建一个新的容器，同 run，但不启动容器</span><br><span class="line"></span><br><span class="line">diff      Inspect changes on a container&#x27;s filesystem   # 查看 docker 容器变化</span><br><span class="line"></span><br><span class="line">events    Get real time events from the server          # 从 docker 服务获取容器实时事件</span><br><span class="line"></span><br><span class="line">exec      Run a command in an existing container        # 在已存在的容器上运行命令</span><br><span class="line"></span><br><span class="line">export    Stream the contents of a container as a tar archive   # 导出容器的内容流作为一个 tar 归档文件[对应 import ]</span><br><span class="line"></span><br><span class="line">history   Show the history of an image                  # 展示一个镜像形成历史</span><br><span class="line"></span><br><span class="line">images    List images                                   # 列出系统当前镜像</span><br><span class="line"></span><br><span class="line">import    Create a new filesystem image from the contents of a tarball # 从tar包中的内容创建一个新的文件系统映像[对应export]</span><br><span class="line"></span><br><span class="line">info      Display system-wide information               # 显示系统相关信息</span><br><span class="line"></span><br><span class="line">inspect   Return low-level information on a container   # 查看容器详细信息</span><br><span class="line"></span><br><span class="line">kill      Kill a running container                      # kill 指定 docker 容器</span><br><span class="line"></span><br><span class="line">load      Load an image from a tar archive              # 从一个 tar 包中加载一个镜像[对应 save]</span><br><span class="line"></span><br><span class="line">login     Register or Login to the docker registry server    # 注册或者登陆一个 docker 源服务器</span><br><span class="line"></span><br><span class="line">logout    Log out from a Docker registry server          # 从当前 Docker registry 退出</span><br><span class="line"></span><br><span class="line">logs      Fetch the logs of a container                 # 输出当前容器日志信息</span><br><span class="line"></span><br><span class="line">port      Lookup the public-facing port which is NAT-ed to PRIVATE_PORT    # 查看映射端口对应的容器内部源端口</span><br><span class="line"></span><br><span class="line">pause     Pause all processes within a container        # 暂停容器</span><br><span class="line"></span><br><span class="line">ps        List containers                               # 列出容器列表</span><br><span class="line"></span><br><span class="line">pull      Pull an image or a repository from the docker registry server   # 从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line"></span><br><span class="line">push      Push an image or a repository to the docker registry server    # 推送指定镜像或者库镜像至docker源服务器</span><br><span class="line"></span><br><span class="line">restart   Restart a running container                   # 重启运行的容器</span><br><span class="line"></span><br><span class="line">rm        Remove one or more containers                 # 移除一个或者多个容器</span><br><span class="line"></span><br><span class="line">rmi       Remove one or more images       # 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才可继续或 -f 强制删除]</span><br><span class="line"></span><br><span class="line">run       Run a command in a new container              # 创建一个新的容器并运行一个命令</span><br><span class="line"></span><br><span class="line">save      Save an image to a tar archive                # 保存一个镜像为一个 tar 包[对应 load]</span><br><span class="line"></span><br><span class="line">search    Search for an image on the Docker Hub         # 在 docker hub 中搜索镜像</span><br><span class="line"></span><br><span class="line">start     Start a stopped containers                    # 启动容器</span><br><span class="line"></span><br><span class="line">stop      Stop a running containers                     # 停止容器</span><br><span class="line"></span><br><span class="line">tag       Tag an image into a repository                # 给源中镜像打标签</span><br><span class="line"></span><br><span class="line">top       Lookup the running processes of a container   # 查看容器中运行的进程信息</span><br><span class="line"></span><br><span class="line">unpause   Unpause a paused container                    # 取消暂停容器</span><br><span class="line"></span><br><span class="line">version   Show the docker version information           # 查看 docker 版本号</span><br><span class="line"></span><br><span class="line">wait      Block until a container stops, then print its exit code   # 截取容器停止时的退出状态值</span><br></pre></td></tr></table></figure>



<h2 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h2><h3 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h3><h4 id="镜像是分层的"><a href="#镜像是分层的" class="headerlink" title="镜像是分层的"></a>镜像是分层的</h4><p>以我们的pull为例，在下载的过程中我们可以看到docker的镜像好像是在一层一层下载</p>
<p><img src="1.png"></p>
<h4 id="UnionFS（联合文件系统）"><a href="#UnionFS（联合文件系统）" class="headerlink" title="UnionFS（联合文件系统）"></a>UnionFS（联合文件系统）</h4><p>Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，他支持<font color="red">对文件系统的修改作为一次提交来一层层的叠加，</font>同时可以将不同目录挂载到同一个虚拟文件系统下（unite several disectories into a single virtual filesystem）Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p><strong>特性</strong>：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<h4 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h4><p>Docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p>bootfs(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是引导文件系统bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p>rootfs (root file system) ，在bootfs之上。包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。 </p>
<p><strong>问题</strong>：平时我们安装进虚拟机的CentOS都是好几个G，为什么docker这里才200M？？</p>
<p>对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供 rootfs 就行了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别, 因此不同的发行版可以公用bootfs。</p>
<h4 id="Docker为什么要采用这种分层结构？"><a href="#Docker为什么要采用这种分层结构？" class="headerlink" title="Docker为什么要采用这种分层结构？"></a>Docker为什么要采用这种分层结构？</h4><p>镜像分层最大的一个好处就是共享资源，方便复制迁移，就是为了复用。</p>
<p>比如说多个镜像都从相同的base镜像构建而来，那么Docker Host只需要在磁盘上保存同时，内存也只需加载一份base镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p>
<h3 id="Docker分层重要理解"><a href="#Docker分层重要理解" class="headerlink" title="Docker分层重要理解"></a>Docker分层重要理解</h3><p><strong><font color="coral">Docker镜像层都是只读的，容器层是可写的。</font></strong></p>
<p>当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称作“容器层”，“容器层”之下的都被叫镜像层。</p>
<p>所以，对容器的改动——无论添加、删除、还是修改文件都只会发成在容器层中。只有容器层是可写的，容器层下面的所有镜像层都只是可读的。</p>
<p><img src="2.png"></p>
<h3 id="Docker镜像commit操作案例"><a href="#Docker镜像commit操作案例" class="headerlink" title="Docker镜像commit操作案例"></a>Docker镜像commit操作案例</h3><ul>
<li>docker commit 提交容器副本使之称为一个新的镜像</li>
<li><code>docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 要创建的目标镜像名:[标签名]</code></li>
</ul>
<p>案例演示：ubunt容器安装vim</p>
<ul>
<li>从Hub上下载ubuntu镜像到本地并成功运行</li>
<li>原始的默认ubuntu镜像不带vim命令</li>
<li>外网连通的情况下，安装vim</li>
<li>安装完成后，commit我们自己的新镜像</li>
<li>启动我们的镜像并和原来的对比</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[william@arch ~]$ sudo docker run -it ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line">root@57a82b1d18d4:/<span class="comment"># apt-get update</span></span><br><span class="line"></span><br><span class="line">root@57a82b1d18d4:/<span class="comment"># apt-get -y install vim</span></span><br><span class="line"></span><br><span class="line">root@57a82b1d18d4:/<span class="comment"># vim 123.txt</span></span><br><span class="line"></span><br><span class="line">[william@arch ~]$  sudo docker commit -m=<span class="string">&quot;add vim cmd&quot;</span> -a=<span class="string">&quot;william&quot;</span> 57a82b1d18d4 william/ubuntu:1.1</span><br><span class="line"></span><br><span class="line">[william@arch ~]$ sudo docker images</span><br><span class="line"></span><br><span class="line">REPOSITORY       TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">william/ubuntu   1.1       33d04ddcdce9   34 seconds ago   84.1MB</span><br></pre></td></tr></table></figure>



<h2 id="本地镜像发布到阿里云"><a href="#本地镜像发布到阿里云" class="headerlink" title="本地镜像发布到阿里云"></a>本地镜像发布到阿里云</h2><h3 id="本地镜像发布到阿里云流程"><a href="#本地镜像发布到阿里云流程" class="headerlink" title="本地镜像发布到阿里云流程"></a>本地镜像发布到阿里云流程</h3><p><img src="3.png"></p>
<h3 id="镜像的生成方法"><a href="#镜像的生成方法" class="headerlink" title="镜像的生成方法"></a>镜像的生成方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.commit方法</span></span><br><span class="line"><span class="comment"># docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 要创建的目标镜像名:[标签名]</span></span><br><span class="line">sudo docker commit -a william -m <span class="string">&quot;Vim ubuntu&quot;</span> 镜像ID ubuntu-vim:1.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.docker file 之后学</span></span><br></pre></td></tr></table></figure>

<h3 id="将本地镜像推送到阿里云"><a href="#将本地镜像推送到阿里云" class="headerlink" title="将本地镜像推送到阿里云"></a>将本地镜像推送到阿里云</h3><h4 id="创建仓库镜像"><a href="#创建仓库镜像" class="headerlink" title="创建仓库镜像"></a>创建仓库镜像</h4><ul>
<li><p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances">选择控制台，进入容器镜像服务</a></p>
</li>
<li><p>选择个人实例</p>
</li>
<li><p>命名空间</p>
</li>
<li><p>仓库名称</p>
</li>
<li><p>进入管理界面获得脚本</p>
<p><img src="4.png"></p>
</li>
</ul>
<h4 id="将镜像推送到阿里云"><a href="#将镜像推送到阿里云" class="headerlink" title="将镜像推送到阿里云"></a>将镜像推送到阿里云</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">ubuntu-vim   1.1       7c0e2d4866ee   14 seconds ago   161MB</span><br><span class="line">redis        latest    97772dcef71b   6 days ago       111MB</span><br><span class="line">ubuntu       latest    a7870fd478f4   5 weeks ago      69.2MB</span><br><span class="line">tomcat       latest    b64abfdee99c   6 months ago     668MB</span><br><span class="line">redis        6.0.8     d4deb73856a2   20 months ago    98.5MB</span><br><span class="line"></span><br><span class="line">$ sudo docker login --username=william117 registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">$ sudo docker tag 7c0e2d4866ee registry.cn-hangzhou.aliyuncs.com/william117/ubuntu:1.1</span><br><span class="line">$ sudo docker push registry.cn-hangzhou.aliyuncs.com/william117/ubuntu:1.1</span><br></pre></td></tr></table></figure>



<h3 id="将阿里云上的镜像下载到本地"><a href="#将阿里云上的镜像下载到本地" class="headerlink" title="将阿里云上的镜像下载到本地"></a>将阿里云上的镜像下载到本地</h3><p><code>sudo docker pull registry.cn-hangzhou.aliyuncs.com/william117/ubuntu:[镜像版本号]</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull registry.cn-hangzhou.aliyuncs.com/william117/ubuntu:1.1</span><br><span class="line"></span><br><span class="line">$ sudo docker run -it 7c0e2d4866ee /bin/bash</span><br></pre></td></tr></table></figure>



<h2 id="本地镜像发布到私有库"><a href="#本地镜像发布到私有库" class="headerlink" title="本地镜像发布到私有库"></a>本地镜像发布到私有库</h2><h3 id="本地镜像发布到私有库流程"><a href="#本地镜像发布到私有库流程" class="headerlink" title="本地镜像发布到私有库流程"></a>本地镜像发布到私有库流程</h3><p><img src="5.png"></p>
<h3 id="私有库是什么"><a href="#私有库是什么" class="headerlink" title="私有库是什么"></a>私有库是什么</h3><p> Docker Registry是官方提供的工具，可以用于构建私有镜像仓库</p>
<ol>
<li><p>官方Docker Hub地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/%EF%BC%8C%E4%B8%AD%E5%9B%BD%E5%A4%A7%E9%99%86%E8%AE%BF%E9%97%AE%E5%A4%AA%E6%85%A2%E4%BA%86%E4%B8%94%E5%87%86%E5%A4%87%E8%A2%AB%E9%98%BF%E9%87%8C%E4%BA%91%E5%8F%96%E4%BB%A3%E7%9A%84%E8%B6%8B%E5%8A%BF%EF%BC%8C%E4%B8%8D%E5%A4%AA%E4%B8%BB%E6%B5%81%E3%80%82">https://hub.docker.com/，中国大陆访问太慢了且准备被阿里云取代的趋势，不太主流。</a></p>
</li>
<li><p>Dockerhub、阿里云这样的公共镜像仓库可能不太方便，涉及机密的公司不可能提供镜像给公网，所以需要创建一个本地私人仓库供给团队使用，基于公司内部项目构建镜像。</p>
</li>
</ol>
<h3 id="将本地镜像推送到私有库"><a href="#将本地镜像推送到私有库" class="headerlink" title="将本地镜像推送到私有库"></a>将本地镜像推送到私有库</h3><ol>
<li><p>下载镜像Docker Registry</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ sudo docker pull registry</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/registry</span><br><span class="line">b48a9fe99aba: Pull complete</span><br><span class="line">095878aa44ca: Pull complete</span><br><span class="line">04df0d597e2b: Pull complete</span><br><span class="line">e0594d0cd6d6: Pull complete</span><br><span class="line">94a758d8738a: Pull complete</span><br><span class="line">Digest: sha256:169211e20e2f2d5d115674681eb79d21a217b296b43374b8e39f97fcf866b375</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> registry:latest</span><br><span class="line">docker.io/library/registry:latest</span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker images</span><br><span class="line">REPOSITORY                                            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/william117/ubuntu   1.1       7c0e2d4866ee   11 days ago     161MB</span><br><span class="line">redis                                                 latest    97772dcef71b   2 weeks ago     111MB</span><br><span class="line">ubuntu                                                latest    a7870fd478f4   7 weeks ago     69.2MB</span><br><span class="line">tomcat                                                latest    b64abfdee99c   7 months ago    668MB</span><br><span class="line">registry                                              latest    11bf57bb5c31   8 months ago    24.5MB</span><br><span class="line">redis                                                 6.0.8     d4deb73856a2   21 months ago   98.5MB</span><br></pre></td></tr></table></figure></li>
<li><p>运行私有库Registry，相当于本地有个私有的Docker Hub</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认情况下，仓库被创建在容器的/var/lib/registry目录下，建议自行用容器卷映射，方便与宿主机联调</span></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker run -d -p 5000:5000 -v /home/william/myregistry/:/home/<span class="built_in">test</span> --privileged=<span class="literal">true</span> registry</span><br><span class="line">7a74ca4f7bc3bde701d7921c861bd4f799c6e6255e9aa661127bfda1d09b7977</span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:~/DYJ/myregistry$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE      COMMAND                  CREATED          STATUS          PORTS                                       NAMES</span><br><span class="line">7a74ca4f7bc3   registry   <span class="string">&quot;/entrypoint.sh /etc…&quot;</span>   16 seconds ago   Up 16 seconds   0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   mystifying_joliot</span><br></pre></td></tr></table></figure></li>
<li><p>案例演示创建一个新镜像，ubuntu安装ifconfig命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行ubuntu</span></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker run -it ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu容器执行ifconfig命令，发现并没有该命令</span></span><br><span class="line">root@db6c8a0b2695:/<span class="comment"># ifconfig</span></span><br><span class="line">bash: ifconfig: <span class="built_in">command</span> not found</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新ubuntu容器源</span></span><br><span class="line">root@db6c8a0b2695:/<span class="comment"># apt update</span></span><br><span class="line">Get:1 http://ports.ubuntu.com/ubuntu-ports jammy InRelease [270 kB]</span><br><span class="line">Get:2 http://ports.ubuntu.com/ubuntu-ports jammy-updates InRelease [114 kB]</span><br><span class="line">Get:3 http://ports.ubuntu.com/ubuntu-ports jammy-backports InRelease [99.8 kB]</span><br><span class="line">Get:4 http://ports.ubuntu.com/ubuntu-ports jammy-security InRelease [110 kB]</span><br><span class="line">Get:5 http://ports.ubuntu.com/ubuntu-ports jammy/main arm64 Packages [1758 kB]</span><br><span class="line">Get:6 http://ports.ubuntu.com/ubuntu-ports jammy/restricted arm64 Packages [24.2 kB]</span><br><span class="line">Get:7 http://ports.ubuntu.com/ubuntu-ports jammy/universe arm64 Packages [17.2 MB]</span><br><span class="line">Get:8 http://ports.ubuntu.com/ubuntu-ports jammy/multiverse arm64 Packages [224 kB]</span><br><span class="line">Get:9 http://ports.ubuntu.com/ubuntu-ports jammy-updates/restricted arm64 Packages [81.1 kB]</span><br><span class="line">Get:10 http://ports.ubuntu.com/ubuntu-ports jammy-updates/universe arm64 Packages [234 kB]</span><br><span class="line">Get:11 http://ports.ubuntu.com/ubuntu-ports jammy-updates/main arm64 Packages [580 kB]</span><br><span class="line">Get:12 http://ports.ubuntu.com/ubuntu-ports jammy-updates/multiverse arm64 Packages [1250 B]</span><br><span class="line">Get:13 http://ports.ubuntu.com/ubuntu-ports jammy-backports/universe arm64 Packages [5812 B]</span><br><span class="line">Get:14 http://ports.ubuntu.com/ubuntu-ports jammy-security/universe arm64 Packages [108 kB]</span><br><span class="line">Get:15 http://ports.ubuntu.com/ubuntu-ports jammy-security/restricted arm64 Packages [61.7 kB]</span><br><span class="line">Get:16 http://ports.ubuntu.com/ubuntu-ports jammy-security/main arm64 Packages [269 kB]</span><br><span class="line">Fetched 21.2 MB <span class="keyword">in</span> 1min 8s (310 kB/s)</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">16 packages can be upgraded. Run <span class="string">&#x27;apt list --upgradable&#x27;</span> to see them.</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu容器安装net-tools</span></span><br><span class="line">root@db6c8a0b2695:/<span class="comment"># apt install net-tools</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  net-tools</span><br><span class="line">0 upgraded, 1 newly installed, 0 to remove and 16 not upgraded.</span><br><span class="line">Need to get 207 kB of archives.</span><br><span class="line">After this operation, 774 kB of additional disk space will be used.</span><br><span class="line">Get:1 http://ports.ubuntu.com/ubuntu-ports jammy/main arm64 net-tools arm64 1.60+git20181103.0eebece-1ubuntu5 [207 kB]</span><br><span class="line">Fetched 207 kB <span class="keyword">in</span> 5s (38.9 kB/s)</span><br><span class="line">debconf: delaying package configuration, since apt-utils is not installed</span><br><span class="line">Selecting previously unselected package net-tools.</span><br><span class="line">(Reading database ... 4389 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../net-tools_1.60+git20181103.0eebece-1ubuntu5_arm64.deb ...</span><br><span class="line">Unpacking net-tools (1.60+git20181103.0eebece-1ubuntu5) ...</span><br><span class="line">Setting up net-tools (1.60+git20181103.0eebece-1ubuntu5) ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu容器执行ifconfig命令</span></span><br><span class="line">root@db6c8a0b2695:/<span class="comment"># ifconfig</span></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 15090  bytes 22180068 (22.1 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 3322  bytes 183806 (183.8 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将该有net-tools工具的ubuntu镜像，创建成一个新的镜像</span></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker commit -m=<span class="string">&quot;ifconfig cmd add&quot;</span> -a=<span class="string">&quot;william&quot;</span> db6c8a0b2695 ubuntu:1.2</span><br><span class="line">sha256:07bca3d7c4a16461b32f57c09a306d9b597bb39c39d6f0dc7d2b1bc8489781f5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看本地镜像仓库</span></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker images</span><br><span class="line">REPOSITORY                                            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">ubuntu                                                1.2       07bca3d7c4a1   8 seconds ago   104MB</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/william117/ubuntu   1.1       7c0e2d4866ee   11 days ago     161MB</span><br><span class="line">redis                                                 latest    97772dcef71b   2 weeks ago     111MB</span><br><span class="line">ubuntu                                                latest    a7870fd478f4   7 weeks ago     69.2MB</span><br><span class="line">tomcat                                                latest    b64abfdee99c   7 months ago    668MB</span><br><span class="line">registry                                              latest    11bf57bb5c31   8 months ago    24.5MB</span><br><span class="line">redis                                                 6.0.8     d4deb73856a2   21 months ago   98.5MB</span><br></pre></td></tr></table></figure></li>
<li><p>curl验证私服库上有什么镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE      COMMAND                  CREATED          STATUS          PORTS                                       NAMES</span><br><span class="line">54549fde7be3   ubuntu     <span class="string">&quot;/bin/bash&quot;</span>              41 minutes ago   Up 41 minutes                                               cool_wilbur</span><br><span class="line">7a74ca4f7bc3   registry   <span class="string">&quot;/entrypoint.sh /etc…&quot;</span>   42 minutes ago   Up 42 minutes   0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   mystifying_joliot</span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:~$ curl -XGET http://10.211.55.3:5000/v2/_catalog</span><br><span class="line">&#123;<span class="string">&quot;repositories&quot;</span>:[]&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>将新镜像ubuntu:1.2修改符合私服规范的Tag</p>
<p><code>docker tag 镜像:Tag Host:Port/Repository:Tag</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ sudo docker tag ubuntu:1.2 10.211.55.3:5000/ubuntu:1.2</span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker images</span><br><span class="line">REPOSITORY                                            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">10.211.55.3:5000/ubuntu                               1.2       07bca3d7c4a1   25 hours ago    104MB</span><br><span class="line">ubuntu                                                1.2       07bca3d7c4a1   25 hours ago    104MB</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/william117/ubuntu   1.1       7c0e2d4866ee   12 days ago     161MB</span><br><span class="line">redis                                                 latest    97772dcef71b   2 weeks ago     111MB</span><br><span class="line">ubuntu                                                latest    a7870fd478f4   7 weeks ago     69.2MB</span><br><span class="line">tomcat                                                latest    b64abfdee99c   7 months ago    668MB</span><br><span class="line">registry                                              latest    11bf57bb5c31   8 months ago    24.5MB</span><br><span class="line">redis                                                 6.0.8     d4deb73856a2   21 months ago   98.5MB</span><br></pre></td></tr></table></figure></li>
<li><p>修改配置文件使之支持http</p>
<p>Docker默认不允许http方式推送镜像。所以我们需要配置/etc/docker/daemon.json来取消限制</p>
<p><strong>修改完后不生效，建议重启Docker。Docker重启后，所有Docker容器将会停止。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ cat /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://lsq7tfu3.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 上面是之前配置的阿里云镜像加速器，我们需要在阿里云镜像加速器下面写上&quot;insecure-registries&quot;:[&quot;10.211.55.3:5000&quot;]</span></span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:~$ cat /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://lsq7tfu3.mirror.aliyuncs.com&quot;</span>],</span><br><span class="line">  <span class="string">&quot;insecure-registries&quot;</span>:[<span class="string">&quot;10.211.55.3:5000&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启Docker后需要重新运行私服仓库</span></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker run -d -p 5000:5000 -v /home/william/DYJ/myregistry/:/home/<span class="built_in">test</span> --privileged=<span class="literal">true</span> registry</span><br><span class="line">3bbcd1f874b5bb2b2a3931d3dd77182d239a5a012dd0e54f58e5cb383701990c</span><br></pre></td></tr></table></figure></li>
<li><p>push推送到私服库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ sudo docker push 10.211.55.3:5000/ubuntu:1.2</span><br><span class="line">The push refers to repository [10.211.55.3:5000/ubuntu]</span><br><span class="line">d53c1aceb6e1: Pushed</span><br><span class="line">13e8c0db60e7: Pushed</span><br><span class="line">1.2: digest: sha256:af7b0352137dcbe7c9ea4de6c4c9e438dd8bba885e6937ad1e97cd53a0fc1913 size: 741</span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker images</span><br><span class="line">REPOSITORY                                            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">10.211.55.3:5000/ubuntu                               1.2       07bca3d7c4a1   25 hours ago    104MB</span><br><span class="line">ubuntu                                                1.2       07bca3d7c4a1   25 hours ago    104MB</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/william117/ubuntu   1.1       7c0e2d4866ee   12 days ago     161MB</span><br><span class="line">redis                                                 latest    97772dcef71b   2 weeks ago     111MB</span><br><span class="line">ubuntu                                                latest    a7870fd478f4   7 weeks ago     69.2MB</span><br><span class="line">tomcat                                                latest    b64abfdee99c   7 months ago    668MB</span><br><span class="line">registry                                              latest    11bf57bb5c31   8 months ago    24.5MB</span><br><span class="line">redis                                                 6.0.8     d4deb73856a2   21 months ago   98.5MB</span><br></pre></td></tr></table></figure></li>
<li><p>再次curl验证私服库上有什么镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ curl -XGET http://10.211.55.3:5000/v2/_catalog</span><br><span class="line">&#123;<span class="string">&quot;repositories&quot;</span>:[<span class="string">&quot;ubuntu&quot;</span>]&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>pull到本地并运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除本地镜像以作验证</span></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker rmi -f 10.211.55.3:5000/ubuntu:1.2</span><br><span class="line">Untagged: 10.211.55.3:5000/ubuntu:1.2</span><br><span class="line">Untagged: 10.211.55.3:5000/ubuntu@sha256:af7b0352137dcbe7c9ea4de6c4c9e438dd8bba885e6937ad1e97cd53a0fc1913</span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker rmi -f ubuntu:1.2</span><br><span class="line">Untagged: ubuntu:1.2</span><br><span class="line">Deleted: sha256:07bca3d7c4a16461b32f57c09a306d9b597bb39c39d6f0dc7d2b1bc8489781f5</span><br><span class="line">Deleted: sha256:ad133ac82d25ca03ee07e8fb53055321eb9ef89b13ce9bbefa957cf90bf76454</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看docker镜像</span></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker images</span><br><span class="line">REPOSITORY                                            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/william117/ubuntu   1.1       7c0e2d4866ee   12 days ago     161MB</span><br><span class="line">redis                                                 latest    97772dcef71b   2 weeks ago     111MB</span><br><span class="line">ubuntu                                                latest    a7870fd478f4   7 weeks ago     69.2MB</span><br><span class="line">tomcat                                                latest    b64abfdee99c   7 months ago    668MB</span><br><span class="line">registry                                              latest    11bf57bb5c31   8 months ago    24.5MB</span><br><span class="line">redis                                                 6.0.8     d4deb73856a2   21 months ago   98.5MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从私服库拉取ubuntu镜像，注意Tag号要带上</span></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker pull 10.211.55.3:5000/ubuntu:1.2</span><br><span class="line">1.2: Pulling from ubuntu</span><br><span class="line">ed02c6ade914: Already exists</span><br><span class="line">07b9b2314dd0: Pull complete</span><br><span class="line">Digest: sha256:af7b0352137dcbe7c9ea4de6c4c9e438dd8bba885e6937ad1e97cd53a0fc1913</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> 10.211.55.3:5000/ubuntu:1.2</span><br><span class="line">10.211.55.3:5000/ubuntu:1.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果忘记了版本号，可以通过curl http://仓库IP:5000/v2/镜像名称/tags/list 查看</span></span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:/etc/docker$ curl http://10.211.55.3:5000/v2/ubuntu/tags/list</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;ubuntu&quot;</span>,<span class="string">&quot;tags&quot;</span>:[<span class="string">&quot;1.2&quot;</span>]&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Docker容器数据卷"><a href="#Docker容器数据卷" class="headerlink" title="Docker容器数据卷"></a>Docker容器数据卷</h2><h3 id="坑：容器卷记得加入-–privilege-true"><a href="#坑：容器卷记得加入-–privilege-true" class="headerlink" title="坑：容器卷记得加入 [–privilege=true]"></a><font color="red"><strong>坑：容器卷记得加入 [–privilege=true]</strong></font></h3><p>为什么要开启权限</p>
<p>Docker挂载主机目录访问如果出现<font color="red">cannot open directory .: Permission denied</font></p>
<p>解决办法：在挂载目录后多加一个–privilege=true参数即可</p>
<p>如果是CentOS7安全模块会比之前系统版本加强，不安全的会先禁止，所以目录挂载的情况被默认为不安全的行为。</p>
<p>在SELinux里面挂载目录被禁止掉了，如果要开启，我们一般使用–privilege=true命令，扩大容器的权限解决挂载目录没有权限的问题，也即使用该参数，container内的root拥有真正的root权限，否则，container内的root只是外部的一个普通用户权限。</p>
<h3 id="回顾-本地镜像发布到私有库，参数V"><a href="#回顾-本地镜像发布到私有库，参数V" class="headerlink" title="回顾 [本地镜像发布到私有库，参数V]"></a>回顾 [本地镜像发布到私有库，参数V]</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ sudo docker run -d -p 5000:5000 -v /william/myregistry/:/tmp/registry --privileged=<span class="literal">true</span> registry</span><br><span class="line"></span><br><span class="line"><span class="comment">#	v 														添加自定义的容器卷</span></span><br><span class="line"><span class="comment"># /william/myregistry/ 					宿主机路径</span></span><br><span class="line"><span class="comment"># /tmp/registry									Docker容器内路径</span></span><br><span class="line"><span class="comment"># --privilege=true							放开权限，运行容器实例以后，完成了容器和宿主机的某个绝对路径互通，实现了信息共享</span></span><br></pre></td></tr></table></figure>

<h3 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h3><p>Docker容器数据卷，即Docker Volume（卷）</p>
<p>当Docker容器运行的时候，会产生一些列的数据文件，这些数据文件会在关闭Docker容器时，直接消失的。但是其中产生部分的数据内容，我们是希望能够把它给保存起来，另做它用的。</p>
<p><code>关闭Docker容器=删除内部除了image底层数据的其他全部内容，即删库跑路</code></p>
<p>所以我们期望：</p>
<ul>
<li>将应用于运行的环境打包形成容器运行，伴随着容器运行产生的数据，我们希望这些数据能够持久化。</li>
<li>希望容器之间也能够实现数据的共享</li>
</ul>
<p>Docker容器产生的数据同步到本地，这样关闭容器的时候，数据是在本地的，不会影响数据的安全性。</p>
<p>Docker的容器卷技术也就是将容器内部目录和本地目录进行一个同步，即挂载。</p>
<p><code>总结：容器的持久化和同步化操作，容器之间也是可以数据共享的（但是注意挂载不是等于同步！！！）</code></p>
<p>卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但补数据联合文件系统，因此能够绕过Union File System提供一些用于持续存储或共享数据的特性：</p>
<p>卷的设计目的就是<font color="red">数据的持久化</font>，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂载的数据卷。</p>
<ul>
<li><p>一句话：有点类似我们Redis里面的rdb和aof文件</p>
</li>
<li><p>将docker容器内的数据保存进宿主机的磁盘中</p>
</li>
<li><p>运行一个带有容器卷存储功能的容器实例</p>
<p><code>docker run -it --privileged=true -v /宿主机绝对路径目录: /容器内目录 镜像名</code></p>
</li>
</ul>
<h3 id="容器数据卷能干嘛"><a href="#容器数据卷能干嘛" class="headerlink" title="容器数据卷能干嘛"></a>容器数据卷能干嘛</h3><p>将docker容器内的数据保存进宿主机的磁盘中，完成敏感数据和重要数据的持久化和备份</p>
<p>Docker容器产生的数据，如果不备份，那么当容器实例删除后，容器内的数据自然也就没有了。为了能保存数据在Docker中我们使用卷。</p>
<p><strong>特点:</strong></p>
<ul>
<li><p>数据卷可在容器之间共享或重用数据</p>
</li>
<li><p>卷中的更改可以直接生效</p>
<ul>
<li>相较于docker cp更方便</li>
</ul>
</li>
<li><p>数据卷中的更改不会包含在镜像的更新中</p>
</li>
<li><p>数据卷的生命周期一直持续到没有容器使用为止</p>
</li>
</ul>
<p><img src="6.png"></p>
<h3 id="数据卷案例"><a href="#数据卷案例" class="headerlink" title="数据卷案例"></a>数据卷案例</h3><h4 id="宿主-vs-容器之间映射添加容器卷"><a href="#宿主-vs-容器之间映射添加容器卷" class="headerlink" title="宿主 vs 容器之间映射添加容器卷"></a>宿主 vs 容器之间映射添加容器卷</h4><p>直接添加命令</p>
<ul>
<li><p>命令</p>
<p>查看容器卷：<code>sudo docker volume ls</code></p>
<p><code>sudo docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录 镜像名 </code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ sudo docker run -it -v /home/william/DYJ/myregistry/:/home/<span class="built_in">test</span> ubuntu /bin/bash</span><br></pre></td></tr></table></figure></li>
<li><p>查看数据卷是否挂载成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@27776923a655:~<span class="comment"># cd /home/test</span></span><br><span class="line">root@27776923a655:/home/<span class="built_in">test</span><span class="comment"># touch hello.txt</span></span><br></pre></td></tr></table></figure>

<p><code>docker inspect 容器ID</code>        将容器的版本、属性信息以Json串的形式暴露</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~/DYJ/myregistry$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED        STATUS        PORTS     NAMES</span><br><span class="line">27776923a655   ubuntu    <span class="string">&quot;/bin/bash&quot;</span>   18 hours ago   Up 18 hours             tender_kilby</span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:~/DYJ/myregistry$ sudo docker inspect 27776923a655</span><br><span class="line">			...</span><br><span class="line">        <span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;bind&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/home/william/DYJ/myregistry&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;/home/test&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;rprivate&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure></li>
<li><p>容器和宿主机之间数据共享</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~/DYJ/myregistry$ <span class="built_in">pwd</span></span><br><span class="line">/home/william/DYJ/myregistry</span><br><span class="line">william@william-ARM-Ubuntu:~/DYJ/myregistry$ ls</span><br><span class="line">hello.txt</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="读写规则映射添加说明"><a href="#读写规则映射添加说明" class="headerlink" title="读写规则映射添加说明"></a>读写规则映射添加说明</h4><ol>
<li><p>读写（默认）</p>
<ul>
<li><code>sudo docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:rw 镜像名</code></li>
<li>默认同上案例，默认就是rw</li>
</ul>
</li>
<li><p>只读</p>
<ul>
<li>容器实例内部被限制，只能读取不能写</li>
<li>如果此时宿主机写入内容，可以同步给容器内，容器可以读取到</li>
<li><code>sudo docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:ro 镜像名</code></li>
<li>ro = read only</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~/DYJ/myregistry$ sudo docker run -it --privileged=<span class="literal">true</span> -v /home/william/DYJ/myregistry:/home/<span class="built_in">test</span>:ro ubuntu</span><br><span class="line">[sudo] password <span class="keyword">for</span> william:</span><br><span class="line">root@97b22f619d7d:/<span class="comment"># cd /home/test/</span></span><br><span class="line">root@97b22f619d7d:/home/<span class="built_in">test</span><span class="comment"># ls</span></span><br><span class="line">1.txt  2.txt  3.txt  hello.txt</span><br><span class="line">root@97b22f619d7d:/home/<span class="built_in">test</span><span class="comment"># touch 4.txt</span></span><br><span class="line">touch: cannot touch <span class="string">&#x27;4.txt&#x27;</span>: Read-only file system</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="卷的继承和共享"><a href="#卷的继承和共享" class="headerlink" title="卷的继承和共享"></a>卷的继承和共享</h4><ol>
<li><p>容器1完成和宿主机的映射</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~/DYJ/myregistry$ sudo docker run -it --privileged=<span class="literal">true</span> -v /home/william/DYJ/myregistry:/home/<span class="built_in">test</span> --name tender_kilby ubuntu</span><br></pre></td></tr></table></figure></li>
<li><p>容器2继承容器1的卷规则</p>
<p><code>docker run -it --privileged=true --volumes-from 父类 --name u2 ubuntu</code></p>
<ul>
<li>父类为要u2容器继承的容器名称</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~/DYJ/myregistry$ docker run -it --privileged=<span class="literal">true</span> --volumes-from u1 --name u2 ubuntu</span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:~/DYJ/myregistry$ sudo docker run -it --privileged=<span class="literal">true</span> --volumes-from tender_kilby --name u2 ubuntu</span><br><span class="line"></span><br><span class="line">root@20699ce4cbc1:/<span class="comment"># cd /home/test/</span></span><br><span class="line"></span><br><span class="line">root@20699ce4cbc1:/home/<span class="built_in">test</span><span class="comment"># ls</span></span><br><span class="line">1.txt  2.txt  3.txt  hello.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>容器1停止后，容器2还会和宿主机挂载同样的路径</li>
<li>容器1恢复后，会同步容器2和宿主机的文件</li>
</ul>
</li>
</ol>
<h2 id="Docker常规安装简介"><a href="#Docker常规安装简介" class="headerlink" title="Docker常规安装简介"></a>Docker常规安装简介</h2><h3 id="总体步骤"><a href="#总体步骤" class="headerlink" title="总体步骤"></a>总体步骤</h3><ul>
<li>搜索镜像</li>
<li>拉去镜像</li>
<li>查看镜像</li>
<li>启动镜像</li>
<li>停止容器</li>
<li>移除容器</li>
</ul>
<h3 id="安装-tomcat"><a href="#安装-tomcat" class="headerlink" title="安装 tomcat"></a>安装 tomcat</h3><ol>
<li><p>docker hub上查找镜像</p>
<p>或者使用命令<code>docker search tomcat</code></p>
</li>
<li><p>从docker hub上拉取tomcat镜像到本地</p>
<p><code>docker pull tomcat</code></p>
</li>
<li><p>docker images查看是否有拉取到的tomcat</p>
<p><code>docker images tomcat</code></p>
</li>
<li><p>使用tomcat镜像创建容器实例（也叫运行镜像）</p>
<p><code>docker run -it -p 8080:8080 tomcat</code></p>
<ul>
<li>-p 小写，主机端口:docker容器端口</li>
<li>-P 大写，随机分配端口</li>
<li>-i 交互</li>
<li>-t 终端</li>
<li>-d 后台</li>
</ul>
<p>通过-P进行演示：主机端口为49153映射到tomcat容器端口8080</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[william@arch ~]$ sudo docker run -it -P tomcat</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[william@arch ~]$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED        STATUS        PORTS                                         NAMES</span><br><span class="line">22747fb85b75   tomcat        <span class="string">&quot;catalina.sh run&quot;</span>        22 hours ago   Up 22 hours   0.0.0.0:49153-&gt;8080/tcp, :::49153-&gt;8080/tcp   lucid_mccarthy</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>访问tomcat首页</p>
<ul>
<li><p><strong>问题</strong>：访问 192.168.80.130:49153 出现 404 错误</p>
</li>
<li><p>解决方法：</p>
<ul>
<li>可能没有映射端口或者没有关闭防火墙</li>
<li>把 webapps.dist 目录换成 webapps</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看tomcat容器ID</span></span><br><span class="line">[william@arch ~]$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED        STATUS        PORTS                                         NAMES</span><br><span class="line">22747fb85b75   tomcat        <span class="string">&quot;catalina.sh run&quot;</span>        22 hours ago   Up 22 hours   0.0.0.0:49153-&gt;8080/tcp, :::49153-&gt;8080/tcp   lucid_mccarthy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入该容器</span></span><br><span class="line">[william@arch ~]$ sudo docker <span class="built_in">exec</span> -it 22747fb85b75 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除/usr/local/tomcat 目录下的webapps目录</span></span><br><span class="line">root@22747fb85b75:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># rm -rf webapps</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将webapps.dist更改为webapps</span></span><br><span class="line">root@22747fb85b75:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># mv webapps.dist/ webapps</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\William\AppData\Roaming\Typora\typora-user-images\image-20220803125107969.png" alt="image-20220803125107969"></p>
</li>
</ul>
</li>
<li><p>免修改版说明</p>
</li>
</ol>
<ul>
<li><p>安装tomcat8</p>
<p><code>docker pull billygoo/tomcat8-jdk8</code></p>
</li>
<li><p>运行tomcat8</p>
<p><code>docker run -d -p 8080:8080 --name mytomcat8 billygoo/tomcat8-jdk8</code></p>
</li>
</ul>
<h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><ol>
<li><p>docker hub 上面查找mysql镜像</p>
<p>或者<code>docker search mysql</code></p>
</li>
<li><p>从docker hub上（阿里云加速器）拉去mysql镜像到本地标签为5.7</p>
<p><code>docker pull mysql:5.7</code></p>
</li>
<li><p>使用mysql5.7镜像创建容器（也叫运行镜像）</p>
<ul>
<li><p>使用命令出处 <strong>hub.docker.com/_/mysql</strong></p>
<p><code>docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</code></p>
<p><font color="Darkorange"><strong>docker启动的端口号，可能被主机占用了，导致docker起不来</strong></font></p>
<p>进入mysql</p>
<p><code>docker exec -it some-mysql /bin/bash</code></p>
<p><code>mysql -uroot -p</code></p>
</li>
<li><p>简单版（不推荐）</p>
<ul>
<li><p>建库、建表插入数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database db01;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use db01;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; create table aa(id int,name varchar(20));</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into aa values(1,&#x27;z3&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br></pre></td></tr></table></figure></li>
<li><p>外部Win11连接运行在docker上的mysql容器实例服务</p>
</li>
<li><p>问题</p>
<ul>
<li><p>插入中文数据时报错：</p>
<p>docker上默认字符集编码隐患</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE &#x27;character%&#x27;;</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| Variable_name            | Value                      |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| character_set_client     | latin1                     |</span><br><span class="line">| character_set_connection | latin1                     |</span><br><span class="line">| character_set_database   | latin1                     |</span><br><span class="line">| character_set_filesystem | binary                     |</span><br><span class="line">| character_set_results    | latin1                     |</span><br><span class="line">| character_set_server     | latin1                     |</span><br><span class="line">| character_set_system     | utf8                       |</span><br><span class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li><p>删除容器后，里面的mysql数据怎么办？</p>
<p>删除后就该跑路了</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>实战版</p>
<ul>
<li><p>新建mysql容器实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[william@arch ~]$ docker run -d -p 3306:3306 --privileged=<span class="literal">true</span> -v /home/william/DYJ/docker/mysql/<span class="built_in">log</span>:/var/<span class="built_in">log</span>/mysql -v /home/william/DYJ/docker/mysql/data:/var/lib/mysql -v /home/william/DYJ/docker/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456  --name mysql mysql:5.7</span><br></pre></td></tr></table></figure>

<p>记录一次启动mysql失败的问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[william@arch ~]$ sudo docker run -d -P --privileged=<span class="literal">true</span> -v /home/william/DYJ/docker/mysql/<span class="built_in">log</span>:/var/<span class="built_in">log</span>/mysql -v /home/william/DYJ/docker/mysql/data:/var/lib/mysql -v /home/william/DYJ/docker/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456  --name mysql1 mysql:5.7</span><br><span class="line">docker: Error response from daemon: Conflict. The container name <span class="string">&quot;/mysql1&quot;</span> is already <span class="keyword">in</span> use by container <span class="string">&quot;2651888e8211ebe53a49bdea5c8ea8a3a41b08d83cea5d92ac8ba509830b1610&quot;</span>. You have to remove (or rename) that container to be able to reuse that name.</span><br><span class="line">See <span class="string">&#x27;docker run --help&#x27;</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示这个容器已经被使用，必须删除或者重命名才能使用该容器。如果我们使用docker ps 会发现下面更本没有容器</span></span><br><span class="line"></span><br><span class="line">[william@arch ~]$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用docker ps -l 则会显示最新创建的容器包括所有状态</span></span><br><span class="line">[william@arch ~]$ sudo docker ps -l</span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS    PORTS     NAMES</span><br><span class="line">2651888e8211   mysql:5.7   <span class="string">&quot;docker-entrypoint.s…&quot;</span>   7 minutes ago   Created             mysql1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除后便可启动</span></span><br><span class="line">[william@arch ~]$ sudo docker rm 2651888e8211</span><br></pre></td></tr></table></figure></li>
<li><p>新建my.cnf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[william@arch conf]$ <span class="built_in">cd</span> /home/william/DYJ/docker/mysql/conf</span><br><span class="line"></span><br><span class="line">[william@arch conf]$ vim my.cnf</span><br><span class="line"></span><br><span class="line">[william@arch conf]$ cat my.cnf</span><br><span class="line">[client]</span><br><span class="line">default_character_set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">collation_server=utf8_general_ci</span><br><span class="line">character_set_server=utf8</span><br></pre></td></tr></table></figure></li>
<li><p>重新启动mysql容器实例，再重新进入并查看字符编码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[william@arch conf]$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                                                                                        NAMES</span><br><span class="line">75eba7aaa729   mysql:5.7   <span class="string">&quot;docker-entrypoint.s…&quot;</span>   6 minutes ago   Up 6 minutes   0.0.0.0:49155-&gt;3306/tcp, :::49155-&gt;3306/tcp, 0.0.0.0:49154-&gt;33060/tcp, :::49154-&gt;33060/tcp   mysql1</span><br><span class="line">22747fb85b75   tomcat      <span class="string">&quot;catalina.sh run&quot;</span>        29 hours ago    Up 29 hours    0.0.0.0:49153-&gt;8080/tcp, :::49153-&gt;8080/tcp                                                  lucid_mccarthy</span><br><span class="line">57a82b1d18d4   ubuntu      <span class="string">&quot;/bin/bash&quot;</span>              2 weeks ago     Up 2 weeks                                                                                                  busy_jennings</span><br><span class="line">[william@arch conf]$ sudo docker restart 75eba7aaa729</span><br><span class="line">75eba7aaa729</span><br><span class="line"></span><br><span class="line">[william@arch conf]$ sudo docker <span class="built_in">exec</span> -it 75eba7aaa729 bash</span><br><span class="line"></span><br><span class="line">bash-4.2<span class="comment"># mysql -uroot -p</span></span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.39 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;character%&#x27;</span>;</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| Variable_name            | Value                      |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| character_set_client     | utf8                       |</span><br><span class="line">| character_set_connection | utf8                       |</span><br><span class="line">| character_set_database   | utf8                       |</span><br><span class="line">| character_set_filesystem | binary                     |</span><br><span class="line">| character_set_results    | utf8                       |</span><br><span class="line">| character_set_server     | utf8                       |</span><br><span class="line">| character_set_system     | utf8                       |</span><br><span class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li><p>新建库新建表，再插入中文测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database db01;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use db01;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; create table bb(id int,name varchar(20));</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 没法打中文的话，就远程连接</span><br><span class="line">mysql&gt; GRANT ALL ON *.* TO user@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27; WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into bb values(1,&#x27;张三&#x27;);</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from bb;</span><br><span class="line">+------+--------+</span><br><span class="line">| id   | name   |</span><br><span class="line">+------+--------+</span><br><span class="line">|    1 | 张三   |</span><br><span class="line">+------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li><p>结论：</p>
<ul>
<li><font color="Darkorange">docker安装完MySQL并run出容器后，建议请先修改完字符集编码后，再新建mysql库-表-插入数据</font></li>
<li>数据库最好指定端口号，不要使用-P</li>
</ul>
</li>
<li><p>假如将当前容器实例删除，再重来一次，之前建的db01实例还有吗？</p>
<p>依然存在</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h3><ol>
<li><p>从docker hub上（阿里云加速器）拉取redis镜像到本地标签为6.0.8</p>
<p>或者<code>docker pull redis:6.0.8</code></p>
</li>
<li><p>入门命令</p>
<p><code>docker run -d -p 6379:6379 redis:6.0.8</code></p>
<p><code>docker exec -it e6df68a8353a /bin/bash</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@e6df68a8353a:/data<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>命令提醒：容器卷记得加入 <code>--privileged=true</code></p>
</li>
<li><p>在CentOS宿主机下新建目录<code>/app/redis</code></p>
<p><code>mkdir -p /app/redis</code></p>
</li>
<li><p>将一个redis.conf文件模板拷贝进<code>/app/redis</code>目录下</p>
<p><code>cp /home/william/DYJ/redis-6.0.8/redis.conf /app/redis</code></p>
</li>
<li><p><code>/app/readis</code>目录下修改redis.conf文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 1.允许redis外地连接</span><br><span class="line">注释掉 #bind 127.0.0.1</span><br><span class="line"></span><br><span class="line"># 2.将daemonize yes 设置成 no，或者注释掉（因为该配置和docker run中 -d 参数冲突，会导致容器一直启动失败）</span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line"># 3.开启redis数据持久化（可选）</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># 4.关闭保护模式（可选）</span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure></li>
<li><p>使用redis6.0.8镜像创建容器（也叫运行镜像）</p>
<p><code>sudo docker run -p 6379:6379 --name redis --privileged=true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ sudo docker run -p 6379:6379 --name redis --privileged=<span class="literal">true</span> -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">e64e1fb8ed15a85e0fcaf7a68a0ea15ce1f14a8d78b49b3ae7b3851f172f7262</span><br><span class="line"></span><br><span class="line">william@william-ARM-Ubuntu:~$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED          STATUS          PORTS                                       NAMES</span><br><span class="line">e64e1fb8ed15   redis:6.0.8   <span class="string">&quot;docker-entrypoint.s…&quot;</span>   14 seconds ago   Up 13 seconds   0.0.0.0:6379-&gt;6379/tcp, :::6379-&gt;6379/tcp   redis</span><br><span class="line">3bbcd1f874b5   registry      <span class="string">&quot;/entrypoint.sh /etc…&quot;</span>   8 days ago       Up 8 days       0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   youthful_knuth</span><br></pre></td></tr></table></figure></li>
<li><p>测试redis-cli连接上来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">william@william-ARM-Ubuntu:~$ sudo docker <span class="built_in">exec</span> -it redis /bin/bash</span><br><span class="line"></span><br><span class="line">root@e64e1fb8ed15:~<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>请证明docker启动使用了我们自己指定的配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.将宿主机的 redis.conf 中 databases 16 更改为 10</span></span><br><span class="line">databases 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.在docker redis-cli中输入</span></span><br><span class="line">127.0.0.1:6379[10]&gt; select 16</span><br><span class="line">(error) ERR DB index is out of range</span><br><span class="line">127.0.0.1:6379[10]&gt; select 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[10]&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过这种方式可以证明docker使用了我们自己指定的配置文件</span></span><br></pre></td></tr></table></figure></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Docker/" rel="tag"># Docker</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/20/%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E5%8F%A5%E5%AD%90/" rel="prev" title="随机生成句子">
      <i class="fa fa-chevron-left"></i> 随机生成句子
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/07/20/%E5%91%BC%E5%85%B0%E6%B2%B3%E4%BC%A0/" rel="next" title="呼兰河传">
      呼兰河传 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="nav-number">1.</span> <span class="nav-text">Docker的基本组成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">Docker常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%AE%E5%8A%A9%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%91%BD%E4%BB%A4"><span class="nav-number">2.1.</span> <span class="nav-text">帮助启动类命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="nav-number">2.2.</span> <span class="nav-text">镜像命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">2.3.</span> <span class="nav-text">容器命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E8%A6%81"><span class="nav-number">2.4.</span> <span class="nav-text">重要</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E5%AE%88%E6%8A%A4%E5%BC%8F%E5%AE%B9%E5%99%A8%EF%BC%88%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89"><span class="nav-number">2.4.1.</span> <span class="nav-text">启动守护式容器（后台服务器）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97"><span class="nav-number">2.4.2.</span> <span class="nav-text">查看容器日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="nav-number">2.4.3.</span> <span class="nav-text">查看容器内部运行的进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8%E7%BB%86%E8%8A%82"><span class="nav-number">2.4.4.</span> <span class="nav-text">查看容器内部细节</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9B%E5%85%A5%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8%E5%B9%B6%E4%BB%A5%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BA%A4%E4%BA%92"><span class="nav-number">2.4.5.</span> <span class="nav-text">进入正在运行的容器并以命令行交互</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E5%AE%B9%E5%99%A8"><span class="nav-number">2.4.6.</span> <span class="nav-text">导入和导出容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">2.5.</span> <span class="nav-text">小总结-常用命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker%E9%95%9C%E5%83%8F"><span class="nav-number">3.</span> <span class="nav-text">Docker镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">3.1.</span> <span class="nav-text">是什么</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%95%9C%E5%83%8F%E6%98%AF%E5%88%86%E5%B1%82%E7%9A%84"><span class="nav-number">3.1.1.</span> <span class="nav-text">镜像是分层的</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UnionFS%EF%BC%88%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="nav-number">3.1.2.</span> <span class="nav-text">UnionFS（联合文件系统）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="nav-number">3.1.3.</span> <span class="nav-text">Docker镜像加载原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E9%87%87%E7%94%A8%E8%BF%99%E7%A7%8D%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84%EF%BC%9F"><span class="nav-number">3.1.4.</span> <span class="nav-text">Docker为什么要采用这种分层结构？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker%E5%88%86%E5%B1%82%E9%87%8D%E8%A6%81%E7%90%86%E8%A7%A3"><span class="nav-number">3.2.</span> <span class="nav-text">Docker分层重要理解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker%E9%95%9C%E5%83%8Fcommit%E6%93%8D%E4%BD%9C%E6%A1%88%E4%BE%8B"><span class="nav-number">3.3.</span> <span class="nav-text">Docker镜像commit操作案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="nav-number">4.</span> <span class="nav-text">本地镜像发布到阿里云</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E6%B5%81%E7%A8%8B"><span class="nav-number">4.1.</span> <span class="nav-text">本地镜像发布到阿里云流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%95%9C%E5%83%8F%E7%9A%84%E7%94%9F%E6%88%90%E6%96%B9%E6%B3%95"><span class="nav-number">4.2.</span> <span class="nav-text">镜像的生成方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="nav-number">4.3.</span> <span class="nav-text">将本地镜像推送到阿里云</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93%E9%95%9C%E5%83%8F"><span class="nav-number">4.3.1.</span> <span class="nav-text">创建仓库镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="nav-number">4.3.2.</span> <span class="nav-text">将镜像推送到阿里云</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%8A%E7%9A%84%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E5%88%B0%E6%9C%AC%E5%9C%B0"><span class="nav-number">4.4.</span> <span class="nav-text">将阿里云上的镜像下载到本地</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E7%A7%81%E6%9C%89%E5%BA%93"><span class="nav-number">5.</span> <span class="nav-text">本地镜像发布到私有库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E7%A7%81%E6%9C%89%E5%BA%93%E6%B5%81%E7%A8%8B"><span class="nav-number">5.1.</span> <span class="nav-text">本地镜像发布到私有库流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A7%81%E6%9C%89%E5%BA%93%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">5.2.</span> <span class="nav-text">私有库是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E7%A7%81%E6%9C%89%E5%BA%93"><span class="nav-number">5.3.</span> <span class="nav-text">将本地镜像推送到私有库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">6.</span> <span class="nav-text">Docker容器数据卷</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9D%91%EF%BC%9A%E5%AE%B9%E5%99%A8%E5%8D%B7%E8%AE%B0%E5%BE%97%E5%8A%A0%E5%85%A5-%E2%80%93privilege-true"><span class="nav-number">6.1.</span> <span class="nav-text">坑：容器卷记得加入 [–privilege&#x3D;true]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E9%A1%BE-%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E7%A7%81%E6%9C%89%E5%BA%93%EF%BC%8C%E5%8F%82%E6%95%B0V"><span class="nav-number">6.2.</span> <span class="nav-text">回顾 [本地镜像发布到私有库，参数V]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">6.3.</span> <span class="nav-text">什么是容器数据卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="nav-number">6.4.</span> <span class="nav-text">容器数据卷能干嘛</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%A1%88%E4%BE%8B"><span class="nav-number">6.5.</span> <span class="nav-text">数据卷案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%BF%E4%B8%BB-vs-%E5%AE%B9%E5%99%A8%E4%B9%8B%E9%97%B4%E6%98%A0%E5%B0%84%E6%B7%BB%E5%8A%A0%E5%AE%B9%E5%99%A8%E5%8D%B7"><span class="nav-number">6.5.1.</span> <span class="nav-text">宿主 vs 容器之间映射添加容器卷</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E8%A7%84%E5%88%99%E6%98%A0%E5%B0%84%E6%B7%BB%E5%8A%A0%E8%AF%B4%E6%98%8E"><span class="nav-number">6.5.2.</span> <span class="nav-text">读写规则映射添加说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%B7%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E5%85%B1%E4%BA%AB"><span class="nav-number">6.5.3.</span> <span class="nav-text">卷的继承和共享</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker%E5%B8%B8%E8%A7%84%E5%AE%89%E8%A3%85%E7%AE%80%E4%BB%8B"><span class="nav-number">7.</span> <span class="nav-text">Docker常规安装简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="nav-number">7.1.</span> <span class="nav-text">总体步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-tomcat"><span class="nav-number">7.2.</span> <span class="nav-text">安装 tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85mysql"><span class="nav-number">7.3.</span> <span class="nav-text">安装mysql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85redis"><span class="nav-number">7.4.</span> <span class="nav-text">安装redis</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="蒙珣"
      src="/images/logo.JPG">
  <p class="site-author-name" itemprop="name">蒙珣</p>
  <div class="site-description" itemprop="description">过去就像攥在手中的一把干沙，自以为攥得很紧，其实早就从指缝中流光了。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">157</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/AustinWilliam117" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AustinWilliam117" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:mengxu1996@gmail.com" title="E-Mail → mailto:mengxu1996@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://music.163.com/#/user/home?id=246814561" title="NetEase → https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;246814561" rel="noopener" target="_blank"><i class="fa fa-music fa-fw"></i>NetEase</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/39266086" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;39266086" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>Bilibili</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">蒙珣</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">521k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">7:54</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":225,"height":450},"mobile":{"show":false},"log":false});</script></body>
</html>
